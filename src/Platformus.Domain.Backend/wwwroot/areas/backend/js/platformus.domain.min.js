(function(n){function t(){if(typeof FileReader!="undefined"){var n=$("#imageDragAndDropArea");n.length!=0&&(n[0].ondragover=function(){return n.addClass("image-drag-and-drop-area--dragging"),!1},n[0].ondragleave=function(){return n.removeClass("image-drag-and-drop-area--dragging"),!1},n[0].ondrop=function(t){var r,i;for(n.removeClass("image-drag-and-drop-area--dragging"),r=new FormData,i=0;i!=t.dataTransfer.files.length;i++)r.append("files",t.dataTransfer.files[i]);return $.ajax({url:"/backend/imageuploader",data:r,processData:!1,contentType:!1,type:"POST",success:function(n){parent.platformus.forms.imageUploaderForm.uploadingFinished(n.replace("filename=",String.empty))},error:function(n,t){parent.platformus.forms.imageUploaderForm.uploadingErrorOccurred(t)}}),parent.platformus.forms.imageUploaderForm.uploadingStarted(!1),!1})}}n.imageUploader={};n.imageUploader.imageSelected=function(){parent.platformus.forms.imageUploaderForm.uploadingStarted(!0);document.form.submit()};n.registerBehavior(function(){t()})})(window.platformus=window.platformus||{}),function(n){function p(){$(document).on("mouseenter","#imageCropperFrame",function(){t=!0});$(document).on("mouseleave","#imageCropperFrame",function(){t=!1});$(document).on("mouseenter","#imageCropperGrip",function(){i=!0});$(document).on("mouseleave","#imageCropperGrip",function(){i=null});$(document).on("mousedown",function(n){return o?!t&&!i?!0:(r=n.pageX,u=n.pageY,t?(s=!0,l=$("#imageCropperFrame").position().left,a=$("#imageCropperFrame").position().top):i&&(h=!0,f=$("#imageCropperFrame").width(),c=$("#imageCropperFrame").height()),!1):!0});$(document).on("mousemove",function(n){var nt,e,o,b;if(s){var t=$("#imageCropperFrame"),i=t.find("img"),g=$("#imageCropperGrip"),k=n.pageX-r,d=n.pageY-u,p=l+k,w=a+d;p<-1&&(p=-1);p>i.width()-t.width()-1&&(p=i.width()-t.width()-1);w<-1&&(w=-1);w>i.height()-t.height()-1&&(w=i.height()-t.height()-1);t.css({left:p,top:w});i.css({left:p*-1-1,top:w*-1-1});g.css({left:t.position().left+t.width()-4,top:t.position().top+t.height()-4})}else if(h){var t=$("#imageCropperFrame"),i=t.find("img"),g=$("#imageCropperGrip"),k=n.pageX-r,d=n.pageY-u;v==null&&y==null?(e=f+k,t.position().left+e>i.width()-1&&(e=i.width()-t.position().left-1),o=c+d,t.position().top+o>i.height()-1&&(o=i.height()-t.position().top-1)):(nt=(k+d)/2,e=f+nt,t.position().left+e>i.width()-1&&(e=i.width()-t.position().left-1),b=f/e,o=c/b,t.position().top+o>i.height()-1&&(b=o/(i.height()-t.position().top-1),e=e/b,o=i.height()-t.position().top-1));t.css({width:e,height:o});g.css({left:t.position().left+t.width()-4,top:t.position().top+t.height()-4})}});$(document).on("mouseup",function(){return o?(s=null,h=null,r=null,u=null,!1):!0})}var e=null,o=!1,s=!1,h=!1,t=!1,i=!1,r=0,u=0,v=0,y=0,l=0,a=0,f=0,c=0;n.forms=n.forms||{};n.forms.imageUploaderForm={};n.forms.imageUploaderForm.show=function(t){return e=t,n.forms.baseForm.show("/backend/content/imageuploaderform",p,"image-uploader-pop-up-form")};n.forms.imageUploaderForm.uploadingStarted=function(t){$("#imageUploader").hide();$("#imageUploadingIndicator").show();t&&setTimeout(function(){n.forms.imageUploaderForm.isFinished()},100)};n.forms.imageUploaderForm.uploadingFinished=function(n){$("#imageUploadingIndicator").hide();var i=$("#imageCropper").show(),t=$("<img>").addClass("image-uploader-pop-up-form__image-cropper-image").attr("src","/images/temp/"+n).on("load",function(){setTimeout(function(){var e=$("<div>").addClass("image-uploader-pop-up-form__image-cropper-shader").appendTo(i),f,s,h;e.css({width:t.width(),height:t.height()});var u=$("<div>").addClass("image-uploader-pop-up-form__image-cropper-frame").attr("id","imageCropperFrame").appendTo(i),n=100,r=100;n>t.width()&&(f=t.width()/n,n=t.width(),r*=f);r>t.height()&&(f=t.height()/r,n*=f,r=t.height());u.css({width:n,height:r});s=$("<img>").addClass("image-uploader-pop-up-form__image-cropper-image-fragment").attr("src",t.attr("src")).css({width:t.width(),height:t.height()}).appendTo(u);h=$("<div>").addClass("image-uploader-pop-up-form__image-cropper-grip").attr("id","imageCropperGrip").css({left:u.width()-5,top:u.height()-5}).appendTo(i);o=!0},250)}).appendTo(i)};n.forms.imageUploaderForm.isFinished=function(){var t=document.getElementById("imageUploader").contentWindow.document.body.innerHTML,i,r;t.indexOf("filename=")!=-1?(i=t.replace("filename=",n.string.empty).replace("<pre>",n.string.empty).replace("<\/pre>",n.string.empty),n.forms.imageUploaderForm.uploadingFinished(i)):t.indexOf("error=")!=-1?(r=t.replace("error=",n.string.empty),n.forms.imageUploaderForm.uploadingErrorOccurred(r)):setTimeout(function(){n.forms.imageUploaderForm.isFinished()},100)};n.forms.imageUploaderForm.uploadingErrorOccurred=function(n){alert(n)};n.forms.imageUploaderForm.done=function(){var r=$("#imageCropper img"),t=$("#imageCropperFrame"),i=r[0].naturalWidth/r.width(),u=Math.round((t.position().left+1)*i),f=Math.round((t.position().top+1)*i),o=Math.round(t.width()*i),s=Math.round(t.height()*i);return $.get("/backend/imageuploader/getcroppedimageurl",{imageUrl:r.attr("src"),x:u,y:f,width:o,height:s,sourceWidth:this.width==null?-1:this.width,sourceHeight:this.height==null?-1:this.height},function(t){e!=null&&e(t);n.forms.imageUploaderForm.hideAndRemove()}),!1};n.forms.imageUploaderForm.hideAndRemove=function(){return n.forms.baseForm.hideAndRemove()}}(window.platformus=window.platformus||{}),function(n){function i(){n.forms.activeForm.find(".table__row").bind("click",r)}function r(){$(this).find(".table__cell--header").length==0&&$(this).toggleClass("table__row--selected")}function u(){var t=n.string.empty;return n.forms.activeForm.find(".table__row--selected").each(function(i,r){n.string.isNullOrEmpty(t)||(t+=",");t+=$(r).data("objectId")}),t}var t=null;n.forms=n.forms||{};n.forms.objectSelectorForm={};n.forms.objectSelectorForm.show=function(r,u,f){return t=f,n.forms.baseForm.show("/backend/content/objectselectorform?classid="+r+"&objectids="+u,i,"object-selector-pop-up-form")};n.forms.objectSelectorForm.select=function(){return t!=null&&t(u()),n.forms.baseForm.hideAndRemove()};n.forms.objectSelectorForm.hideAndRemove=function(){return n.forms.baseForm.hideAndRemove()}}(window.platformus=window.platformus||{}),function(n){function t(n){return $("<div>").addClass("tabs__tab").attr("data-tab-page-id",n.id).html(n.name)}function i(n){var t=$("#tabPage"+n.id);return t.length!=0?t:$("<div>").addClass("tab-pages__tab-page").attr("id","tabPage"+n.id)}n.editors=n.editors||[];n.editors.create=function(r){for(var f,s,e,u,h,c=$("#tabs"),l=$("#tabPages"),o=0;o<r.length;o++)for(f=r[o],t(f).appendTo(c),s=i(f).appendTo(l),e=0;e<f.members.length;e++)u=f.members[e],u.relationClass!=null?n.editors.relation.create(s,u):u.propertyDataType!=null&&(h=n.editors[u.propertyDataType.javaScriptEditorClassName].create,h.call(this,s,u))}}(window.platformus=window.platformus||{}),function(n){n.editors=n.editors||[];n.editors.base={};n.editors.base.createLabel=function(n){return $("<label>").addClass("field__label").addClass("label").html(n.name)};n.editors.base.createCulture=function(t){var i=$("<div>").addClass("field__culture");return n.editors.base.createFlag(t).appendTo(i),i};n.editors.base.createFlag=function(n){return $("<div>").addClass("field__culture-flag").html(n.culture.code)};n.editors.base.createMultilingualSeparator=function(){return $("<div>").addClass("field__multilingual-separator")};n.editors.base.getIdentity=function(t,i){return"propertyMember"+t.id+(i==null?n.string.empty:i.culture.code)}}(window.platformus=window.platformus||{}),function(n){function i(i){var u=$("<div>").addClass("form__field").addClass("field"),r,f;if(n.editors.base.createLabel(i).appendTo(u),i.isPropertyLocalizable)for(u.addClass("field--multilingual"),r=0;r<i.property.localizations.length;r++)f=i.property.localizations[r],f.culture.code!="__"&&(n.editors.base.createCulture(f).appendTo(u),t(i,f).appendTo(u),r!=i.property.localizations.length-1&&n.editors.base.createMultilingualSeparator().appendTo(u));else for(r=0;r<i.property.localizations.length;r++)f=i.property.localizations[r],f.culture.code=="__"&&t(i,f).appendTo(u);return u}function t(t,i){var r=n.editors.base.getIdentity(t,i),u=$("<input>").addClass("field__text-box");return i.culture.code!="__"&&u.addClass("field__text-box--multilingual"),u.addClass("text-box").attr("id",r).attr("name",r).attr("type","text").attr("value",i.value)}n.editors=n.editors||[];n.editors.singleLinePlainText={};n.editors.singleLinePlainText.create=function(n,t){i(t).appendTo(n)}}(window.platformus=window.platformus||{}),function(n){function i(i){var u=$("<div>").addClass("form__field").addClass("field"),r,f;if(n.editors.base.createLabel(i).appendTo(u),i.isPropertyLocalizable)for(u.addClass("field--multilingual"),r=0;r<i.property.localizations.length;r++)f=i.property.localizations[r],f.culture.code!="__"&&(n.editors.base.createCulture(f).appendTo(u),t(i,f).appendTo(u),r!=i.property.localizations.length-1&&n.editors.base.createMultilingualSeparator().appendTo(u));else for(r=0;r<i.property.localizations.length;r++)f=i.property.localizations[r],f.culture.code=="__"&&t(i,f).appendTo(u);return u}function t(t,i){var r=n.editors.base.getIdentity(t,i),u=$("<textarea>").addClass("field__text-area");return i.culture.code!="__"&&u.addClass("field__text-area--multilingual"),u.addClass("text-area").attr("id",r).attr("name",r).html(i.value)}n.editors=n.editors||[];n.editors.multilinePlainText={};n.editors.multilinePlainText.create=function(n,t){i(t).appendTo(n)}}(window.platformus=window.platformus||{}),function(n){function i(i){var f=$("<div>").addClass("form__field").addClass("field"),r,u;if(n.editors.base.createLabel(i).appendTo(f),i.isPropertyLocalizable)for(f.addClass("field--multilingual"),r=0;r<i.property.localizations.length;r++)u=i.property.localizations[r],u.culture.code!="__"&&(n.editors.base.createCulture(u).appendTo(f),t(i,u).appendTo(f),n.ui.initializeTinyMce(n.editors.base.getIdentity(i,u)),r!=i.property.localizations.length-1&&n.editors.base.createMultilingualSeparator().appendTo(f));else for(r=0;r<i.property.localizations.length;r++)u=i.property.localizations[r],u.culture.code=="__"&&(t(i,u).appendTo(f),n.ui.initializeTinyMce(n.editors.base.getIdentity(i,u)));return f}function t(t,i){var r=n.editors.base.getIdentity(t,i),u=$("<textarea>").addClass("field__text-area");return i.culture.code!="__"&&u.addClass("field__text-area--multilingual"),u.addClass("text-area").attr("id",r).attr("name",r).html(i.value)}n.editors=n.editors||[];n.editors.html={};n.editors.html.create=function(n,t){i(t).appendTo(n)}}(window.platformus=window.platformus||{}),function(n){function t(t){var f=$("<div>").addClass("image-editor").addClass("form__field").addClass("field"),o,e;if(n.editors.base.createLabel(t).appendTo(f),!t.isPropertyLocalizable)for(o=0;o<t.property.localizations.length;o++)e=t.property.localizations[o],e.culture.code=="__"&&(i(t,e).appendTo(f),r(t,e).appendTo(f),u(t,e).appendTo(f));return f}function i(t,i){var r=n.editors.base.getIdentity(t,i);return $("<input>").attr("id",r).attr("name",r).attr("type","hidden").attr("value",i.value)}function r(t,i){var u=n.editors.base.getIdentity(t,i),r=$("<img>").addClass("image-editor__image").attr("id",u+"Image").attr("src",i.value);return i.value==null&&r.hide(),r}function u(n,t){var i=$("<div>").addClass("form__buttons").addClass("form__buttons--minor").addClass("buttons");return f(n,t).appendTo(i),e(n,t).appendTo(i),i}function f(t,i){var r=n.editors.base.getIdentity(t,i);return $("<button>").addClass("buttons__button").addClass("buttons__button--minor").addClass("button").addClass("button--positive").addClass("button--minor").attr("type","button").html("Upload…").click(function(){new n.forms.imageUploaderForm.show(function(n){$("#"+r).val(n);$("#"+r+"Image").attr("src",n).show()})})}function e(t,i){var r=n.editors.base.getIdentity(t,i);return $("<button>").addClass("buttons__button").addClass("buttons__button--minor").addClass("button").addClass("button--negative").addClass("button--minor").attr("type","button").html("Remove").click(function(){$("#"+r).val(n.string.empty);$("#"+r+"Image").removeAttr("src").hide()})}n.editors=n.editors||[];n.editors.image={};n.editors.image.create=function(n,i){t(i).appendTo(n)}}(window.platformus=window.platformus||{}),function(n){function i(t){var i=$("<div>").addClass("relation-editor").addClass("form__field").addClass("field");return t.isRelationSingleParent&&i.hide(),n.editors.base.createLabel(t).appendTo(i),r(t).appendTo(i),u(t).appendTo(i),f(t).appendTo(i),i}function r(n){var i="relationMember"+n.id,r=o(n);return $("<input>").attr("id",i).attr("name",i).attr("type","hidden").attr("value",r).change(function(){t(n)})}function u(n){var t="relationMember"+n.id;return $("<div>").addClass("relation-editor__display-values").attr("id",t+"DisplayValues")}function f(n){var t=$("<div>").addClass("form__buttons").addClass("form__buttons--minor").addClass("buttons");return e(n).appendTo(t),t}function e(t){var i="relationMember"+t.id;return $("<button>").addClass("buttons__button").addClass("buttons__button--minor").addClass("button").addClass("button--positive").addClass("button--minor").attr("type","button").html("Select…").click(function(){n.forms.objectSelectorForm.show(t.relationClass.id,$("#"+i).val(),function(n){$("#"+i).val(n);$("#"+i).trigger("change")})})}function o(t){for(var u,i=n.string.empty,r=0;r<t.relations.length;r++)u=t.relations[r],n.string.isNullOrEmpty(i)||(i+=","),i+=u.primaryId;return i}function t(n){var t="relationMember"+n.id;$.get("/backend/content/getobjectdisplayvalues?objectids="+$("#"+t).val(),function(n){$("#"+t+"DisplayValues").html(n)})}n.editors=n.editors||[];n.editors.relation={};n.editors.relation.create=function(n,r){i(r).appendTo(n);t(r)}}(window.platformus=window.platformus||{});